<div class="dashboard-container">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Budget Dashboard</h1>
      <button class="btn btn-primary" (click)="openAddModal()">+ Add Transaction</button>
    </div>
  
    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <p>Loading dashboard...</p>
    </div>
  
    <!-- Error State -->
    <div *ngIf="error" class="error-message">
      <p>{{ error }}</p>
      <button (click)="loadDashboardData()" class="btn btn-primary">Retry</button>
    </div>
  
    <!-- Dashboard Content -->
    <div *ngIf="!loading && !error" class="dashboard-content">
      
      <!-- Budget Summary Cards -->
      <div class="summary-cards" *ngIf="summary">
        <div class="card income-card">
          <div class="card-header">
            <h3>Total Income</h3>
            <span class="icon">ðŸ’°</span>
          </div>
          <div class="card-body">
            <p class="amount">{{ summary.totalIncome | currencyFormat: summary.currency }}</p>
            <p class="count">{{ summary.incomeCount }} transactions</p>
          </div>
        </div>
  
        <div class="card expense-card">
          <div class="card-header">
            <h3>Total Expenses</h3>
            <span class="icon">ðŸ’¸</span>
          </div>
          <div class="card-body">
            <p class="amount">{{ summary.totalExpenses | currencyFormat: summary.currency }}</p>
            <p class="count">{{ summary.expenseCount }} transactions</p>
          </div>
        </div>
  
        <div class="card balance-card" [class.negative]="monthlySummary && monthlySummary.balance < 0">
          <div class="card-header">
            <h3>This Month Balance</h3>
            <span class="icon">ðŸ“…</span>
          </div>
          <div class="card-body" *ngIf="monthlySummary">
            <p class="amount">{{ monthlySummary.balance | currencyFormat: monthlySummary.currency }}</p>
            <p class="status" [class.negative]="monthlySummary.balance < 0">
              {{ monthlySummary.balance >= 0 ? 'Positive' : 'Negative' }}
            </p>
          </div>
        </div>
  
        <div class="card balance-card" [class.negative]="summary.balance < 0">
          <div class="card-header">
            <h3>Total Balance</h3>
            <span class="icon">ðŸ“Š</span>
          </div>
          <div class="card-body">
            <p class="amount">{{ summary.balance | currencyFormat: summary.currency }}</p>
            <p class="status" [class.negative]="summary.balance < 0">
              {{ summary.balance >= 0 ? 'Positive' : 'Negative' }}
            </p>
          </div>
        </div>
      </div>
  
      <!-- Revenue Usage Indicators -->
      <div class="revenue-usage" *ngIf="monthlySummary && summary">
        <div class="usage-card">
          <h3>Monthly Revenue Used</h3>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width]="getProgressWidth(monthlyRevenueUsedPercentage)"></div>
            </div>
            <span class="percentage">{{ monthlyRevenueUsedPercentage | number:'1.1-1' }}%</span>
          </div>
          <p class="subtitle">{{ monthlyRevenueLeft | currencyFormat: 'PLN' }} left this month</p>
        </div>
  
        <div class="usage-card">
          <h3>Total Revenue Used</h3>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill total" [style.width]="getProgressWidth(totalRevenueUsedPercentage)"></div>
            </div>
            <span class="percentage">{{ totalRevenueUsedPercentage | number:'1.1-1' }}%</span>
          </div>
          <p class="subtitle">{{ monthlySavings | currencyFormat: 'PLN' }} monthly savings</p>
        </div>
      </div>
  
      <!-- Recent Transactions -->
      <div class="recent-transactions">
        <div class="section-header">
          <h2>Recent Transactions</h2>
          <a routerLink="/transactions" class="view-all-link">View All â†’</a>
        </div>
  
        <div class="transactions-list" *ngIf="recentTransactions.length > 0">
          <div 
            *ngFor="let transaction of recentTransactions" 
            class="transaction-item"
            [class]="getTransactionClass(transaction.type)">
            <div class="transaction-info">
              <span class="category">{{ transaction.category }}</span>
              <span class="description">{{ transaction.description }}</span>
              <span class="date">{{ transaction.date | date: 'MMM d, y' }}</span>
            </div>
            <div class="transaction-amount">
              <span class="amount" [class]="getTransactionClass(transaction.type)">
                {{ getTransactionSign(transaction.type) }}{{ transaction.amount | currencyFormat: transaction.currency }}
              </span>
            </div>
          </div>
        </div>
  
        <div class="empty-state" *ngIf="recentTransactions.length === 0">
          <p>No transactions yet</p>
          <button class="btn btn-primary" (click)="openAddModal()">Add Your First Transaction</button>
        </div>
      </div>
  
      <!-- Expenses by Category -->
      <div class="expenses-by-category">
        <div class="section-header">
          <h2>Top Expenses by Category</h2>
          <a routerLink="/statistics" class="view-all-link">View All â†’</a>
        </div>
  
        <div class="category-list" *ngIf="expensesByCategory.length > 0">
          <div *ngFor="let cat of expensesByCategory; let i = index" class="category-item">
            <div class="category-rank">{{ i + 1 }}</div>
            <div class="category-info">
              <div class="category-header">
                <span class="category-name">{{ cat.category }}</span>
                <span class="category-amount">{{ cat.totalAmount | currencyFormat: cat.currency }}</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width]="getProgressWidth(cat.percentage)"></div>
              </div>
              <div class="category-details">
                <span>{{ cat.transactionCount }} transactions</span>
                <span>{{ cat.percentage | number:'1.1-1' }}%</span>
              </div>
            </div>
          </div>
        </div>
  
        <div class="empty-state" *ngIf="expensesByCategory.length === 0">
          <p>No expense data available</p>
        </div>
      </div>
  
    </div>
  
    <!-- Add Transaction Modal -->
    <div class="modal" *ngIf="showAddModal" (click)="closeAddModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Add Transaction</h2>
        <form (ngSubmit)="saveTransaction()">
          <div class="form-group">
            <label>Type</label>
            <select [(ngModel)]="formData.type" name="type" required>
              <option [value]="TransactionType.Income">Income</option>
              <option [value]="TransactionType.Expense">Expense</option>
            </select>
          </div>
          <div class="form-group">
            <label>Amount</label>
            <input type="number" [(ngModel)]="formData.amount" name="amount" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label>Category</label>
            <input list="categories" [(ngModel)]="formData.category" name="category" required>
            <datalist id="categories">
              <option *ngFor="let cat of categories" [value]="cat">
            </datalist>
          </div>
          <div class="form-group">
            <label>Description</label>
            <input type="text" [(ngModel)]="formData.description" name="description">
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" [(ngModel)]="formData.date" name="date" required>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>